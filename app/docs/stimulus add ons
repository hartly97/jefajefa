1) Stimulus controller

app/javascript/controllers/citations_controller.js

import { Controller } from "@hotwired/stimulus"

export default class extends Controller {
  static targets = ["list", "template"]
  static values = { index: Number }

  connect() {
    if (this.indexValue == null) this.indexValue = this._nextIndex()
  }

  add(event) {
    event.preventDefault()
    const html = this.templateTarget.innerHTML.replaceAll("NEW_RECORD", this.indexValue)
    this.listTarget.insertAdjacentHTML("beforeend", html)
    this.indexValue++
  }

  remove(event) {
    event.preventDefault()
    const wrapper = event.currentTarget.closest("[data-citations-wrapper]")
    // mark for destruction if it’s an existing record
    const destroyField = wrapper.querySelector("input[name*='[_destroy]']")
    if (destroyField) {
      destroyField.value = "1"
      wrapper.style.display = "none"
    } else {
      wrapper.remove()
    }
  }

  _nextIndex() {
    // try to infer next index from existing items
    const items = this.listTarget.querySelectorAll("[data-citations-wrapper]")
    return items.length
  }
}


 Make sure your Stimulus setup is loading controllers (you already have Stimulus in this app).

 2) Update your article form

 Wrap the citations area in a controller, add the list and a hidden template. Keep your dropdown + inline-source block exactly as we set it up.

 app/views/articles/_form.html.erb (citations section only)

<h3>Sources & Citations</h3>

<div data-controller="citations" data-citations-index-value="0">
  <!-- existing items go here -->
  <div data-citations-target="list">
    <%= f.fields_for :citations do |cf| %>
      <%= render "citations/fields", f: cf, sources: @sources %>
    <% end %>
  </div>

  <!-- add button -->
  <p class="mt-2">
    <button class="btn" data-action="click->citations#add">+ Add citation</button>
  </p>

  <!-- hidden template for NEW citation rows -->
  <template data-citations-target="template">
    <%= form_fields = fields_for("#{f.object_name}[citations_attributes][NEW_RECORD]", Citation.new, child_index: "NEW_RECORD") do |cf| %>
      <%= j render("citations/fields", f: cf, sources: @sources) %>
    <% end %>
  </template>
</div>


 fields_for … child_index: "NEW_RECORD" gives us a prototype chunk we can safely clone on the client.

 3) Extract a partial for one citation row

 app/views/citations/_fields.html.erb

<div class="citation-fields border p-2 mb-3 rounded" data-citations-wrapper>
  <!-- choose existing Source -->
  <div>
    <%= f.label :source_id, "Source" %>
    <%= f.collection_select :source_id, sources, :id, :title,
          { prompt: "Select a source…" }, { required: true } %>
  </div>

  <!-- or create a new Source inline -->
  <%= f.fields_for :source do |sf| %>
    <details class="mt-2">
      <summary>Or create a new source</summary>
      <div><%= sf.label :title, "Source title" %> <%= sf.text_field :title %></div>
      <div><%= sf.label :author %> <%= sf.text_field :author %></div>
      <div><%= sf.label :publisher %> <%= sf.text_field :publisher %></div>
      <div><%= sf.label :year %> <%= sf.text_field :year %></div>
      <div><%= sf.label :url %> <%= sf.url_field :url %></div>
    </details>
  <% end %>

  <!-- citation details -->
  <div><%= f.label :pages %> <%= f.text_field :pages, placeholder: "e.g., 41–43" %></div>
  <div><%= f.label :quote %> <%= f.text_area :quote %></div>
  <div><%= f.label :note  %> <%= f.text_area :note %></div>

  <!-- remove -->
  <div class="mt-2">
    <%= f.hidden_field :_destroy %>
    <button class="btn" data-action="click->citations#remove">Remove</button>
  </div>
</div>

# 4) Controller/params (you already have this)

accepts_nested_attributes_for :citations, allow_destroy: true

Citation validates presence of source

Citation has accepts_nested_attributes_for :source, reject_if: ->(a){ a['title'].blank? }

article_params includes:

citations_attributes: [
  :id, :source_id, :pages, :quote, :note, :_destroy,
  { source_attributes: [:id, :title, :author, :publisher, :year, :url] }
]

5) Tiny UX tip

Add a help text near the dropdown: “Pick an existing source or open ‘create a new source’—don’t do both.”
If a user does both, Rails will still handle it, but clarity helps.