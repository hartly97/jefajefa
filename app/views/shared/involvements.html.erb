<%# app/views/shared/_involvements.html.erb %>
<div data-controller="involvement-form">
  <h2>Involvements</h2>

  <ul class="list-unstyled" data-involvement-form-target="list">
    <% involvements.each do |inv| %>
      <li class="mb-2" data-involvement-row="<%= inv.id %>">
        <% p = inv.participant %>
        <%= link_to(inv.participant_label, p) if p %>
        <% if inv.role.present? %>  <strong><%= inv.role %></strong><% end %>
        <% if inv.year.present? %> (<%= inv.year %>)<% end %>
        <% if inv.note.present? %>  <em><%= inv.note %></em><% end %>
        <button class="btn btn-sm btn-outline-danger ms-2"
                data-action="involvement-form#remove"
                data-involvement-form-id-param="<%= inv.id %>">Remove</button>
      </li>
    <% end %>
  </ul>

  <hr>

  <h3>Add Soldier Involvement</h3>

  <form data-involvement-form-target="form"
        data-involvable-type="<%= record.class.name %>"
        data-involvable-id="<%= record.id %>"
        data-action="submit->involvement-form#add">
    <input type="hidden" data-involvement-form-target="participantId" id="involvement_participant_id">

    <div class="mb-2">
      <label for="participant_search">Find Soldier</label>
      <input type="text" id="participant_search" placeholder="Type a name" list="participant_suggest" class="form-control">
      <datalist id="participant_suggest"></datalist>
      <small class="text-muted">Pick a suggestion; the ID fills automatically.</small>
    </div>

    <div class="mb-2">
      <label>Role</label>
      <input type="text" data-involvement-form-target="role" class="form-control">
    </div>
    <div class="mb-2">
      <label>Year</label>
      <input type="number" data-involvement-form-target="year" class="form-control">
    </div>
    <div class="mb-3">
      <label>Note</label>
      <input type="text" data-involvement-form-target="note" class="form-control">
    </div>

    <button type="submit" class="btn btn-primary">Add</button>
  </form>
</div>

