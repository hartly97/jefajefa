<div class="container my-4">
  <div class="d-flex flex-column flex-md-row align-items-md-center mb-3 gap-2">
    <h1 class="mb-0">Articles</h1>

    <div class="ms-md-auto d-flex gap-2">
      <%= form_with url: articles_path, method: :get, local: true, class: "d-flex" do %>
        <input name="q" value="<%= params[:q] %>" class="form-control" placeholder="Search articles…">
        <button class="btn btn-outline-secondary ms-2">Search</button>
      <% end %>

      <%= form_with url: articles_path, method: :get, local: true do %>
        <select name="sort" class="form-select" onchange="this.form.submit()">
          <option value="" <%= "selected" if params[:sort].blank? %>>Sort by…</option>
          <option value="new" <%= "selected" if params[:sort]=="new" %>>Newest</option>
          <option value="az"  <%= "selected" if params[:sort]=="az"  %>>A–Z</option>
        </select>
      <% end %>
    </div>
  </div>

  <div class="row g-3">
    <% @articles.each do |article| %>
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm">
          <% if article.respond_to?(:lead_image) && article.lead_image.attached? %>
            <%= image_tag article.lead_image.variant(resize_to_fill: [800, 450]), class: "card-img-top", alt: "" %>
          <% end %>

          <div class="card-body d-flex flex-column">
            <h2 class="h5 card-title mb-2">
              <%= link_to article.title, article_path(article), class: "stretched-link text-decoration-none" %>
            </h2>

            <p class="card-text text-muted mb-3">
              <%= article.description.presence ||
                  truncate(strip_tags(article.body.to_s), length: 160) %>
            </p>

            <div class="mt-auto small text-secondary d-flex flex-wrap align-items-center gap-2">
              <% if article.author.present? %>
                <span class="me-2">By <%= article.author %></span>
              <% end %>
              <% if article.date.present? %>
                <span>• <%= article.date.to_date.strftime("%b %-d, %Y") rescue article.date %></span>
              <% end %>
            </div>

            <div class="mt-2 d-flex flex-wrap gap-1">
              <% article.categories.each do |cat| %>
                <%= link_to cat.name, category_path(cat),
                      class: "badge rounded-pill text-bg-light border" %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="mt-4">
  
    <%= paginate @articles if respond_to?(:paginate) %>
    <%# or pagy_bootstrap_nav(@pagy) if using Pagy %>
  </div>
</div>
<%= will_paginate @articles,
      renderer: PaginationHelper::BootstrapLinkRenderer,
      previous_label: "&laquo;".html_safe,
      next_label: "&raquo;".html_safe %>

<%= link_to   "New Article", new_article_path, class: "btn btn-primary" %>
