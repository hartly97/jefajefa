<p>
  <%= [
    @census.district,
    @census.subdistrict,
    @census.place,
    ("Piece " + @census.piece.to_s if @census.piece.present?),
    ("Folio " + @census.folio.to_s if @census.folio.present?),
    ("Page " + @census.page.to_s  if @census.page.present?)
  ].compact.join(", ") %>
</p>

<% if (url = @census.display_image_url(self)) %>
  <figure class="my-3">
    <a href="<%= url %>" target="_blank" rel="noopener">
      <%= image_tag url,
            alt: (@census.external_image_caption.presence || "Census image"),
            loading: "lazy",
            referrerpolicy: "no-referrer",
            style: "max-width:100%;height:auto" %>
    </a>
    <% if @census.external_image_caption.present? || @census.external_image_credit.present? %>
      <figcaption class="text-muted small mt-1">
        <%= @census.external_image_caption %>
        <% if @census.external_image_credit.present? %>
          <span class="ms-2">(<%= @census.external_image_credit %>)</span>
        <% end %>
      </figcaption>
    <% end %>
  </figure>
<% end %>

<h3>Households</h3>
<% Array(@entries).group_by(&:householdid).each do |hid, rows| %>
  <h4>Household <%= hid.presence || "(unknown)" %></h4>
  <ul>
    <% rows.each do |r| %>
      <li>
        <%= r.respond_to?(:display_name) ? r.display_name : [r.firstname, r.lastname].compact.join(" ") %>
        <% if r.age.present? %> — age <%= r.age %><% end %>
        <% if r.relationshiptohead.present? %> — <%= r.relationshiptohead %><% end %>
        <% if r.birthlikeplacetext.present? %> — born <%= r.birthlikeplacetext %><% end %>
      </li>
    <% end %>
  </ul>
<% end %>
# <h4>
#   Household <%= hid.presence || "(unknown)" %>
#   <%# if hid.present? %>
#     <%#= link_to "(open household)", census_path(@census, householdid: hid), class: "small ms-2" %>
#   <%# end %>
# </h4>
<p class="mt-3">
  <%= link_to "Edit", edit_census_path(@census), class: "btn btn-outline-secondary" %>
  <%= link_to "Back", censuses_path, class: "btn btn-secondary ms-2" %>
</p>


