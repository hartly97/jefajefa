<fieldset class="border rounded p-3 mb-3">
  <legend class="fw-bold small">Image (External)</legend>

  <div class="mb-3">
    <%= f.label :external_image_url, "Image URL (SmugMug)" %>
    <%= f.url_field :external_image_url,
          class: "form-control",
          placeholder: "https://photos.smugmug.com/.../image.jpg" %>
    <div class="form-text">
      Paste a direct image URL (jpg/png/webp). We don’t upload the file; we embed it.
    </div>
  </div>

  <div class="row g-3">
    <div class="col-md-6">
      <%= f.label :external_image_caption, "Caption" %>
      <%= f.text_field :external_image_caption, class: "form-control" %>
    </div>
    <div class="col-md-6">
      <%= f.label :external_image_credit, "Credit / Attribution" %>
      <%= f.text_field :external_image_credit,
            class: "form-control",
            placeholder: "© Your Name / SmugMug" %>
    </div>
  </div>

  <!-- Optional live preview -->
  <div id="image-url-preview" class="mt-3" style="<%= f.object.external_image_url.present? ? "" : "display:none" %>">
    <strong>Preview</strong>
    <div class="ratio ratio-16x9 border">
      <img id="image-url-preview-img"
           alt="Preview"
           src="<%= f.object.external_image_url %>"
           style="object-fit:contain; width:100%; height:100%">
    </div>
  </div>
</fieldset>

<script>
document.addEventListener("turbo:load", attachCensusPreview)
document.addEventListener("turbo:frame-load", attachCensusPreview)
function attachCensusPreview() {
  const input = document.querySelector('input[name="census[external_image_url]"]')
  const box   = document.getElementById('image-url-preview')
  const img   = document.getElementById('image-url-preview-img')
  if (!input || !box || !img) return
  const show = (url) => {
    url = (url || "").trim()
    if (!/^https?:\/\//.test(url)) { box.style.display = "none"; img.removeAttribute('src'); return }
    img.src = url
    box.style.display = ""
  }
  input.addEventListener('input', () => show(input.value))
  show(input.value)
}
</script>
